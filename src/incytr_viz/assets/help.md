### Introduction

The purpose of this tool is to interact with outputs generated by the Incytr pathway discovery tool (citation). 

The left and right panels correspond to pathway data for the two user-provided experimental conditions, as named in the cell clusters input file. See the [project README](https://github.com/cellsignal/incytr-viz/blob/main/README.md) for information on input formatting.

### Filtering

- By default, each condition panel displays pathways upregulated (by adjusted fold change) in that condition. The panel on the left (labeled with a "+" sign) shows pathways with positive adj. fold change values, and the panel on the right shows negative adj. fold change values. 

- Filters available include:

  - Sender cell type
  - Receiver cell type
  - Ligand/Receptor/EM/Target Gene
  - Any role --> display pathways containing selected genes regardless of pathway role
  - Kinase Relationship --> if available, select pathways with a signaling-involed kinase (SiK) relationship between components. For example, filtering on "Receptor --> EM" displays pathways where the receptor is a predicted kinase of the effector molecule.
  
- Filters are applied additively (a pathway must pass all filters in order to be displayed). Except for UMAP-based filtering, filters are applied to both conditions simultaneously. 

- Most metrics are condition-independent. For example, there is one adjusted fold-change value for each pathway, and it is the sign of the value that indicates the condition in which it is upgregulated.

- Some metrics (e.g. signalling probability and p-value) are reported separately for each condition. In these cases, each condition will be filtered according to its corresponding value. Condition-specific metrics are suffixed with the condition name in the incytr analysis package output (e.g. SigProb_5X, SigProb_WT)


### Network View

- The network view shows the number of 4-step networks occurring between various cell types, subject to the applied filter.
- By default, node area is logarithmically (log2) proportional to the cluster's population share within the total cell population for the condition, and edge widths are linearly proportional to the raw number of pathways the edge represents. Sizes can be adjusted in the options tab, as datasets vary significantly. Please select 'Show network weights' and 'Show cluster population sizes' in the options tab to show exact numbers.

- Click on an edge to switch to the river view, which will show the component genes involved in the pathways comprising that edge

- In the options tab, you can choose to:
  - show/hide cell population counts (if provided) and edge weights. Edge weights represent number of pathways.
  - Increase or decrease edge and node sizing. 

### River view

- The river view shows the component genes, and their roles in the pathway, for pathways passing applied filters.
- Click a pathway component to filter results for pathways containing that gene in that role.
- Depending on the number of unique targets passing the filter, targets may be hidden until more filters are applied.
- In the options tab, use the "Color Sankey Flow" tab to color-code the pathways by sender cell type, receiver cell type, or by kinase-substrate relationship

### Downloading Data

Click "Download Current Paths" to download a CSV of pathways passing the currently selected filters. Two CSVs will download - one for each condition. 


### UMAP

Users can bring their own umap data in order to filter pathways based on umap coordinates.

1. Ensure each pathway in your input file has columns "umap1" and "umap2", each corresponding to that pathway's umap coordinates
2. Run incytr, and select the "Show UMAP" option in the options tab to display umap plots for each condition
3. Select an area of the umap plot by clicking and dragging, in order to restrict displayed pathways to those found in that subset

- Umap filtering is condition-specific: filtering on the left/right-hand UMAP only affects the left/right-hand condition
- The umap plots are unaffected by other filtering -- the only change that can be applied to the plot content is to zoom in/out


### Troubleshooting and other tips

- Targets may not be displayed when there are too many unique links in the river plot. Please apply additional filters.
- Filters are applied additively. If an expected pathway is not appearing, it may be that it passes, e.g.,  the current TPDS filter but not PPDS. Try loosening one or more of the filters.
- Some filters may be disabled if the metric is not detected or unavailable. Please see the terminal output on startup to check what metrics were detected.
- "Address already in use" error: This likely means something else is running on the same port on your computer (typically 8000 for this application) 
- Large files (~1M pathways) may take slightly longer to load and render. Applying additional filters will reduce load times. 
- When downloading outputs, your browser may ask you to allow the program to download multiple files.

### Bug reports
- Bug reports are welcome via [Github Issues](https://github.com/cellsignal/incytr-viz/issues)
